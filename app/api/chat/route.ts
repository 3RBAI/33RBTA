import { google } from "@ai-sdk/google"
import { generateText } from "ai"

export async function POST(request: Request) {
  try {
    const { message, context } = await request.json()

    // ุงุณุชุฎุฏุงู ูุญุงููุฉ/ุงุณุชุซูุงุก ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุฃูุถู
    try {
      const { text } = await generateText({
        model: google("gemini-1.5-pro", {
          apiKey: "AIzaSyAcKAuJKw1kzOEJa-QHTtkTaFZyiXkJJLs",
        }),
        prompt: `ุฃูุช ูุณุงุนุฏ ุชุนูููู ุฐูู ููุชุนุงุทู ูู ููุตุฉ ุชุนูู ุฃูููุงูู ุนุฑุจูุฉ. 
        
        ููุงูู:
        1. ุชูุฏูู ุฅุฌุงุจุงุช ุชุนููููุฉ ูููุฏุฉ ููุงุถุญุฉ
        2. ุฏุนู ุงูุทูุงุจ ููุณูุงู ูุชุดุฌูุนูู
        3. ุชูุฏูู ูุตุงุฆุญ ููุชุนูู ุงููุนุงู
        4. ูุณุงุนุฏุฉ ูู ุญู ุงููุดุงูู ุงูุชูููุฉ ูุงูุฃูุงุฏูููุฉ
        5. ุดุฑุญ ุงูููุงููู ุงูุจุฑูุฌูุฉ ุจุทุฑููุฉ ูุจุณุทุฉ
        
        ุงูุณูุงู ุงูุชุนูููู: ${context || "ุฏูุฑุฉ ุชุนููููุฉ ุนุงูุฉ"}
        
        ุณุคุงู/ุฑุณุงูุฉ ุงูุทุงูุจ: ${message}
        
        ูุฏู ุฅุฌุงุจุฉ ูููุฏุฉ ูุชุนููููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ. ูู ูุฏูุฏุงู ููุดุฌุนุงู ููุชูููุงู. 
        ุฅุฐุง ูุงู ุงูุณุคุงู ูุชุนูู ุจุงูุตุญุฉ ุงูููุณูุฉ ุฃู ุงูุชูุชุฑุ ูุฏู ูุตุงุฆุญ ุฏุงุนูุฉ ููุทูุฆูุฉ.
        ุฅุฐุง ูุงู ุงูุณุคุงู ุชูููุงูุ ูุฏู ุฃูุซูุฉ ุนูููุฉ ูููุฏ ุฅุฐุง ูุฒู ุงูุฃูุฑ.
        ุงุณุชุฎุฏู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ ุจุดูู ููุงุณุจ ูุฌุนู ุงูุฑุฏ ุฃูุซุฑ ูุฏูุฉ.`,
        maxTokens: 1000,
        temperature: 0.7,
      })

      return Response.json({ response: text })
    } catch (aiError) {
      console.error("ุฎุทุฃ ูู ุงุณุชุฏุนุงุก Google Gemini API:", aiError)

      // ุงุณุชุฎุฏุงู ุฑุฏ ุงุญุชูุงุทู ูู ุญุงูุฉ ูุดู ุงูุงุชุตุงู ุจู Google Gemini
      return Response.json({
        response:
          "ุฃูุง ููุง ููุณุงุนุฏุชู ูู ููู ุงูุฏุฑุณ! ููููู ุทุฑุญ ุฃุณุฆูุฉ ูุญุฏุฏุฉ ุนู ุงูููุถูุน ุงูุฐู ุชูุงุฌู ุตุนูุจุฉ ูููุ ูุณุฃุญุงูู ุชูุฏูู ุดุฑุญ ูุจุณุท ูุฃูุซูุฉ ุชูุถูุญูุฉ. ๐ ูุง ุชุชุฑุฏุฏ ูู ุชูุถูุญ ุงูููุงุท ุงูุชู ุชุญุชุงุฌ ูุณุงุนุฏุฉ ูููุง.",
      })
    }
  } catch (error) {
    console.error("ุฎุทุฃ ุนุงู ูู API:", error)
    return Response.json(
      {
        response: "ุฃูุง ููุง ููุณุงุนุฏุชู! ูุฑุฌู ุฅุนุงุฏุฉ ุตูุงุบุฉ ุณุคุงูู ุฃู ุทูุจู ุจุทุฑููุฉ ุฃุฎุฑู. ๐",
      },
      { status: 200 }, // ุงุณุชุฎุฏุงู 200 ุจุฏูุงู ูู 500 ูุชุฌูุจ ุฃุฎุทุงุก ุงูุนููู
    )
  }
}
